-- Roblox 玩家检测 + 灵动岛左右延伸动画（无开关版）
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- 参数
local DETECTION_RADIUS = 250
local CAPSULE_HEIGHT = 0.06 -- 高一点
local CAPSULE_WIDTH = 0.18 -- 短一点
local SHOW_TIME = 0.3

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false

-- 胶囊背景
local capsule = Instance.new("Frame")
capsule.Size = UDim2.new(0, 0, CAPSULE_HEIGHT, 0)
capsule.Position = UDim2.new(0.5, 0, 0.2, 0)
capsule.AnchorPoint = Vector2.new(0.5, 0.5)
capsule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
capsule.BackgroundTransparency = 0
capsule.BorderSizePixel = 0
capsule.Visible = false
capsule.Parent = screenGui

local uicorner = Instance.new("UICorner")
uicorner.CornerRadius = UDim.new(1, 0)
uicorner.Parent = capsule

-- 文字
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, 0, 1, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.SourceSansBold
statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
statusLabel.Text = "安全"
statusLabel.Parent = capsule

-- 动画函数（左右延伸）
local function animateCapsule(show)
    if show then
        capsule.Visible = true
        capsule.Size = UDim2.new(0, 0, CAPSULE_HEIGHT, 0)
        capsule.BackgroundTransparency = 0
        TweenService:Create(capsule, TweenInfo.new(SHOW_TIME, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(CAPSULE_WIDTH, 0, CAPSULE_HEIGHT, 0)
        }):Play()
    else
        local tween = TweenService:Create(capsule, TweenInfo.new(SHOW_TIME, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, CAPSULE_HEIGHT, 0)
        })
        tween.Completed:Connect(function()
            capsule.Visible = false
        end)
        tween:Play()
    end
end

-- 检测玩家
local function updateStatus()
    if not capsule.Visible then return end

    local myPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position
    if not myPos then
        statusLabel.Text = "安全"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        return
    end

    local count = 0
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (player.Character.HumanoidRootPart.Position - myPos).Magnitude
            if dist <= DETECTION_RADIUS then
                count = count + 1
            end
        end
    end

    if count == 0 then
        statusLabel.Text = "安全"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    else
        statusLabel.Text = tostring(count)
        statusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    end
end

-- 启动时直接展开
animateCapsule(true)

-- 实时更新
RunService.RenderStepped:Connect(updateStatus)
